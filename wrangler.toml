# =============================================================================
# Cloudflare Worker Configuration for mc-router
# =============================================================================
#
# CONFIGURATION PATTERN:
#   - Non-secrets: Values here MUST align with config/*.yaml (source of truth)
#   - Secrets: Stored in .env.local, symlinked to .dev.vars for wrangler
#
# LOCAL DEVELOPMENT:
#   1. Ensure .dev.vars symlink exists: ln -s .env.local .dev.vars
#   2. Run: wrangler dev --env dev
#
# PRODUCTION DEPLOYMENT:
#   1. Set secrets: wrangler secret put MC_OAUTH_CLIENT_ID
#                   wrangler secret put MC_OAUTH_CLIENT_SECRET
#                   wrangler secret put SESSION_SECRET
#   2. Deploy: wrangler deploy
#
# See docs/ai/RULES.md "Static Sites & Cloudflare Workers" for full details.
# =============================================================================

name = "mc-router"
main = "cloudflare/merge-router.js"
compatibility_date = "2024-01-01"

# -----------------------------------------------------------------------------
# Production non-secrets (source of truth: config/base.yaml)
# -----------------------------------------------------------------------------
[vars]
OIDC_ISSUER_URL = "https://via.mergecombinator.com"
OAUTH_LOGOUT_URL = "https://via.mergecombinator.com/application/o/mergecombinator/end-session/"
COOKIE_DOMAIN = ".mergecombinator.com"  # Enables cross-subdomain sessions (www, docs)
# CONTROL_ADMIN_GROUPS = "via-admins,sigmablox-admins"  # Optional override for /control access
MC_PAGES_ORIGIN = "https://mc-site-dr4.pages.dev"
SIGMABLOX_ORIGIN = "https://www.sigmablox.com"
SIGMABLOX_API_ORIGIN = "https://api.sigmablox.com"
APP_ORIGIN = "https://app.mergecombinator.com"
WINGMAN_ORIGIN = "https://wingman.mergecombinator.com"
CONTROL_ORIGIN = "https://control.mergecombinator.com"

# -----------------------------------------------------------------------------
# Local development overrides (source of truth: config/dev.local.yaml)
# Run with: wrangler dev --env dev
# -----------------------------------------------------------------------------
[env.dev]
name = "mc-router-dev"

[env.dev.vars]
OIDC_ISSUER_URL = "http://localhost:9000"  # Must match config/dev.local.yaml line 16
OAUTH_LOGOUT_URL = "http://localhost:9000/application/o/mergecombinator/end-session/"
MC_PAGES_ORIGIN = "http://localhost:3000"
APP_ORIGIN = "http://localhost:3003"
WINGMAN_ORIGIN = "http://localhost:5173"
CONTROL_ORIGIN = "http://localhost:3300"
