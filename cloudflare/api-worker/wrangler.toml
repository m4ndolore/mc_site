name = "mc-api"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[[routes]]
pattern = "api.mergecombinator.com/*"
zone_name = "mergecombinator.com"

[vars]
MC_PUBLIC_URL = "https://mergecombinator.com"
VIA_ISSUER_URL = "https://via.mergecombinator.com"
OIDC_ISSUER_ALLOWLIST = "https://via.mergecombinator.com/application/o/defense-builders/"
OIDC_AUDIENCE = "mc-web-prod"
OIDC_ROLES_CLAIM = "groups"
CONSOLE_ROLLOUT_MODE = "internal"
CONSOLE_MIN_ROLE_LEVEL = "3"
LEGACY_API_ORIGIN = "https://sigmablox.com"
CORS_ALLOWED_ORIGINS = "https://mergecombinator.com,https://guild.mergecombinator.com,https://wingman.mergecombinator.com"

[[hyperdrive]]
binding = "HYPERDRIVE"
id = "fb55bae8fde3462aa18bc369517d9e36"

[env.staging]
name = "mc-api-staging"
workers_dev = true
routes = []

[[env.staging.hyperdrive]]
binding = "HYPERDRIVE"
id = "fb55bae8fde3462aa18bc369517d9e36"

[env.staging.vars]
MC_PUBLIC_URL = "https://mergecombinator.com"
VIA_ISSUER_URL = "https://via.mergecombinator.com"
OIDC_ISSUER_ALLOWLIST = "https://via.mergecombinator.com/application/o/defense-builders/"
OIDC_AUDIENCE = "mc-web-prod"
OIDC_ROLES_CLAIM = "groups"
CONSOLE_ROLLOUT_MODE = "internal"
CONSOLE_MIN_ROLE_LEVEL = "3"
LEGACY_API_ORIGIN = "https://sigmablox.com"
CORS_ALLOWED_ORIGINS = "https://mergecombinator.com,https://guild.mergecombinator.com,https://wingman.mergecombinator.com"

[env.dev]
name = "mc-api-dev"

[env.dev.vars]
MC_PUBLIC_URL = "http://localhost:5173"
VIA_ISSUER_URL = "http://localhost:9000"
OIDC_ISSUER_ALLOWLIST = "http://localhost:9000/application/o/defense-builders/"
OIDC_AUDIENCE = "mc-web-prod"
OIDC_ROLES_CLAIM = "groups"
CONSOLE_ROLLOUT_MODE = "on"
CONSOLE_MIN_ROLE_LEVEL = "0"
LEGACY_API_ORIGIN = "http://localhost:3001"
CORS_ALLOWED_ORIGINS = "http://localhost:3000,http://localhost:3003,http://localhost:5173"
